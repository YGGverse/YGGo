source common
{
  type        = mysql

  sql_host    = localhost
  sql_user    =
  sql_pass    =
  sql_db      =
  sql_port    = 3306 # optional, default is 3306
}

source hostPage : common
{
  sql_query   = \
    SELECT hostPage.hostPageId, hostPage.rank, hostPage.metaTitle, hostPage.metaDescription, hostPage.metaKeywords, hostPage.data, hostPage.uri, host.name  \
    FROM hostPage \
    JOIN host ON (host.hostId = hostPage.hostId) \
    WHERE host.status = '1' AND hostPage.httpCode = 200

  sql_attr_uint = rank
}

source hostImage : common
{
  sql_query   = \
    SELECT hostImage.hostImageId, hostImage.rank, hostImage.uri, host.name, \
           (SELECT GROUP_CONCAT(CONCAT_WS(' ', hostImageDescription.alt, hostImageDescription.title)) \
              FROM hostImageDescription \
              WHERE hostImageDescription.hostImageId = hostImage.hostImageId) AS imageDescription, \
            (SELECT GROUP_CONCAT(CONCAT_WS(' ', hostPage.metaTitle, hostPage.metaDescription, hostPage.metaKeywords)) \
              FROM hostPage \
              WHERE hostPage.hostPageId IN (SELECT hostImageToHostPage.hostPageId FROM hostImageToHostPage WHERE hostImageToHostPage.hostImageId = hostImage.hostImageId)) AS pageDescription \
    FROM hostImage \
    JOIN host ON (host.hostId = hostImage.hostId) \
    WHERE host.status = '1' AND hostImage.httpCode = 200

  sql_attr_uint = rank
}

index hostPage
{
  source     = hostPage
  morphology = stem_enru, stem_cz, stem_ar
  path       = /var/lib/sphinxsearch/data/hostPage
}

index hostImage
{
  source     = hostImage
  morphology = stem_enru, stem_cz, stem_ar
  path       = /var/lib/sphinxsearch/data/hostImage
}